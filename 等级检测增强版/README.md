# 等级检测增强版插件

## 功能简介
基于原版等级检测插件的增强版本，新增了通过QQ群聊白名单绕过等级限制的功能。

## 主要特性
- ✅ 保留原有等级检测功能
- ✅ 支持QQ群聊白名单管理
- ✅ 白名单玩家可绕过等级限制
- ✅ 支持QQ群内管理白名单
- ✅ 实时通知和日志记录

## 配置说明

### 等级检测设置
- `是否启用`: 是否启用等级检测功能
- `最低限制等级`: 允许进入服务器的最低等级
- `踢出理由`: 踢出等级不足玩家时显示的理由
- `延迟踢出时间`: 检测到等级不足后延迟踢出的时间(秒)

### QQ白名单设置  
- `是否启用`: 是否启用QQ白名单功能
- `云链地址`: WebSocket服务器地址
- `校验码`: 连接验证码(可选)
- `链接的群聊`: 管理白名单的QQ群号
- `管理员QQ`: 有权限管理白名单的QQ号列表
- `白名单玩家`: 白名单玩家数据(自动管理)

### 消息设置
- `白名单绕过提示`: 白名单玩家进入时的提示消息
- `等级不足提示`: 等级不足玩家被踢出时的提示消息

## QQ群指令

### 白名单管理指令

#### 用户指令（所有人可用）
```
#白名单                # 显示帮助信息  
#白名单 添加 [玩家名]    # 绑定玩家到您的QQ（每个QQ只能绑定一个玩家）
#白名单 解绑            # 解绑您绑定的玩家
#白名单 查询            # 查看您绑定的玩家
```

#### 管理员指令（仅管理员可用）
```
#白名单 ban [QQ号]      # 禁止指定QQ绑定白名单
#白名单 移除 [玩家名]    # 强制移除白名单玩家
#白名单 列表            # 查看完整白名单和禁用列表
```

### 功能特性
- **用户自助绑定**: 玩家通过QQ群自行绑定白名单，无需管理员操作
- **一对一绑定**: 每个QQ号只能绑定一个玩家账号，避免滥用
- **解绑功能**: 用户可自行解绑后重新绑定其他角色
- **管理员管控**: 管理员可禁用指定QQ，防止恶意绑定
- **自动安装**: 集成pip模块支持，可自动安装websocket依赖

### 指令权限
- **普通用户**: 可以绑定、解绑、查询自己的白名单
- **管理员**: 拥有所有权限，可管理白名单和禁用QQ账号

## 工作流程

### 玩家使用流程
1. **绑定白名单**: 在QQ群发送 `#白名单 添加 玩家名` 绑定角色
2. **进入服务器**: 绑定成功后可绕过等级限制进入服务器  
3. **解绑重绑**: 如需绑定其他角色，先 `#白名单 解绑` 再重新绑定

### 系统检测流程
1. **玩家加入服务器时**:
   - 系统获取玩家等级信息
   - 首先检查玩家是否在白名单中
   - 如果在白名单中，直接允许进入并发送通知
   - 如果不在白名单中，检查等级是否满足要求
   - 等级不足则延迟踢出玩家

2. **QQ群管理**:
   - 用户可自行绑定和解绑白名单
   - 管理员可禁用恶意QQ号
   - 所有操作都会实时保存到文件

## 安装使用

### 前置要求
如果需要使用QQ白名单功能，需要安装websocket库：

```bash
pip install websocket-client
```

如果无法使用pip，可以从[群服互通云链版插件](https://github.com/ToolDelta-Basic/PluginMarket/tree/main/%E7%BE%A4%E6%9C%8D%E4%BA%92%E9%80%9A%E4%BA%91%E9%93%BE%E7%89%88)复制websocket文件夹到插件目录。

### 安装步骤
1. 将插件文件夹放置到 `插件文件/ToolDelta类式插件/` 目录下
2. 安装websocket库依赖（如需要QQ功能）  
3. 启动ToolDelta，插件会自动创建配置文件
4. 修改配置文件中的相关参数
5. 重启ToolDelta生效

## 注意事项

- **WebSocket库依赖**: QQ功能需要 `websocket-client` 库
- **QQ机器人兼容**: 需要支持WebSocket连接的QQ机器人框架
- **配置文件**: 修改配置后需要重启ToolDelta生效
- **数据存储**: 白名单数据保存在 `插件数据文件/等级检测增强版/whitelist.json`
- **功能独立**: 等级检测和QQ白名单功能可以独立启用/禁用

## 常见问题

### Q: 插件启动时提示"未找到websocket库"怎么办？
A: 
1. 安装pip模块支持插件，插件会自动安装websocket库
2. 手动运行 `pip install websocket-client` 
3. 或者将QQ白名单功能设为禁用（仍可使用等级检测）

### Q: 如何绑定白名单？
A: 在QQ群发送 `#白名单 添加 你的玩家名`，系统会自动绑定。

### Q: 提示"您的QQ已绑定其他玩家"怎么办？
A: 每个QQ只能绑定一个玩家，先发送 `#白名单 解绑` 解除绑定，再重新绑定。

### Q: 被禁用的QQ如何解除？
A: 只有管理员才能禁用QQ，请联系服务器管理员处理。

### Q: 指令没有反应怎么办？  
A: 确认指令格式正确（必须以#开头），检查QQ机器人是否在线。

### Q: 等级检测不生效怎么办？
A: 确认配置中"等级检测设置"的"是否启用"为true，检查最低等级设置。

### Q: 可以只使用等级检测，不用QQ功能吗？
A: 可以！将配置中"QQ白名单设置"的"是否启用"设为false即可。

## 更新日志

### v1.0.0
- 基于原版等级检测插件开发
- 实现用户自助绑定白名单功能
- 支持QQ群聊内管理白名单
- 每个QQ只能绑定一个玩家账号
- 新增解绑和管理员禁用功能
- 集成pip模块自动安装websocket依赖
- 添加完整的帮助系统和权限管理
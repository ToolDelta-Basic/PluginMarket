# McFunction导入器插件

这是一个ToolDelta插件，用于将mcfunction文件导入为游戏内指令方块链，实现类似[dislink.github.io/mcfunction2bdx](https://dislink.github.io/mcfunction2bdx/)网页工具的功能。

## 功能特点

- 🔄 **mcfunction文件解析**: 支持标准mcfunction文件格式，自动处理注释和空行
- 🎯 **智能指令方块布局**: 使用3D蛇形布局算法优化指令方块链的空间利用
- ⚙️ **可自定义尺寸**: 支持用户指定X轴和Z轴延展长度
- 🏗️ **自动方块类型判断**: 智能识别脉冲、连锁、循环型指令方块
- 🎮 **世界交互放置**: 直接在游戏世界中生成指令方块链
- 🖥️ **双模式操作**: 支持交互式菜单和命令行两种操作方式
- 📍 **灵活坐标获取**: 支持手动输入坐标或从玩家位置获取
- ⏱️ **实时进度显示**: 显示放置进度和用时信息

## 安装要求

### 必需插件
- **前置-世界交互**: 用于在游戏世界中放置指令方块

### 安装步骤
1. 将插件文件夹放入 `插件文件/ToolDelta类式插件/` 目录
2. 确保已安装必需的前置插件
3. 启动ToolDelta，插件将自动创建配置文件和数据文件夹

## 使用方法

### 控制台命令

#### 交互式模式（推荐）
```
mcf
```
进入友好的交互界面，逐步完成：
1. 选择要导入的文件
2. 选择坐标获取方式（手动输入或从玩家获取）
3. 设置布局尺寸
4. 确认并开始导入

#### 命令行模式（快速）
```
mcf <文件名或编号> <X坐标> <Y坐标> <Z坐标> [X延展] [Z延展]
```
- `文件名或编号`: mcfunction文件名或文件编号
- `X坐标 Y坐标 Z坐标`: 起始放置坐标
- `X延展 Z延展`: 可选，布局尺寸（使用默认值可省略）

### 使用示例

1. **交互式导入**:
   ```
   mcf
   ```
   按提示逐步操作

2. **快速导入（按编号）**:
   ```
   mcf 1 100 4 200 10 5
   ```
   导入第1个文件到坐标(100,4,200)，使用10x5布局

3. **快速导入（按文件名）**:
   ```
   mcf test.mcfunction -1000 4 -1000
   ```
   导入指定文件，使用默认布局尺寸

## 文件管理

### mcfunction文件位置
插件启动后会在`插件数据文件/McFunction导入器/mcfunction/`目录创建文件夹，请将mcfunction文件放入此目录。

### 支持的文件格式
- `.mcfunction` - 标准mcfunction文件
- `.txt` - 文本文件（包含minecraft指令）

### mcfunction文件格式
```mcfunction
# 这是注释，会被忽略
say 开始执行指令链
give @a diamond 1
teleport @a 0 100 0
# 支持行内注释
effect give @a speed 60 # 给予玩家速度效果
```

## 配置选项

插件配置文件位于`插件配置文件/McFunction导入器.json`:

```json
{
  "默认X轴延展长度": 10,
  "默认Z轴延展长度": 1,
  "默认Y轴高度": 5,
  "放置延迟": 0.1,
  "支持的文件扩展名": [".mcfunction", ".txt"]
}
```

### 配置说明
- `默认X轴延展长度`: 当用户未指定X延展时的默认值
- `默认Z轴延展长度`: 当用户未指定Z延展时的默认值  
- `默认Y轴高度`: 最大允许的Y轴层数，超过时显示警告
- `放置延迟`: 每个指令方块之间的放置间隔（秒，最小0.01秒）
- `支持的文件扩展名`: 支持的文件扩展名列表

## 工作原理

### 1. 文件解析
- 读取mcfunction文件内容
- 过滤注释和空行
- 确保所有指令以`/`开头

### 2. 3D蛇形布局算法
真正的3D蛇形布局，优化指令方块链连接：
```
XZ平面蛇形布局示例 (3x3层):
第1层:          第2层(反向):      第3层:
1 → 2 → 3      9 ← 8 ← 7      10→ 11→ 12
        ↓              ↑              ↓
6 ← 5 ← 4      6 → 5 → 4      15← 14← 13
↑              ↓              ↑
7 → 8 → 9      1 → 2 → 3      16→ 17→ 18
```

### 3. 方块类型判断
- **脉冲型** (0): 第一个指令方块，需要红石激活
- **连锁型** (2): 普通指令，由前一个方块触发
- **循环型** (1): 包含schedule、repeating等循环关键词的指令

### 4. 智能朝向计算
根据3D蛇形布局自动计算最优朝向，确保指令方块链的连续性。

## 性能考虑

- 单次最大支持100x100布局（10000个方块）
- 建议合理规划布局尺寸以优化性能
- 大型指令链建议分批处理
- 最小放置延迟0.01秒，防止服务器过载

## 故障排除

### 常见问题

1. **"世界交互API不可用"**
   - 确保已安装"前置-世界交互"插件

2. **"文件不存在"**
   - 检查文件是否放在正确的目录
   - 使用`mcf`命令查看可用文件

3. **"需要X层高度，可能超出限制"**
   - 增大X或Z延展长度以减少层数
   - 或者拆分成多个较小的mcfunction文件

4. **"放置延迟不能小于0.01秒"**
   - 检查配置文件中的放置延迟设置
   - 确保值不小于0.01

5. **放置过快导致错误**
   - 增加配置中的"放置延迟"值
   - 减少单次处理的指令数量

## 版本历史

### v1.0.0
- 实现基本的mcfunction文件解析功能
- 支持3D蛇形布局算法
- 双模式操作界面（交互式+命令行）
- 灵活的坐标获取方式
- 实时进度显示和用时统计
- 严格的配置验证机制

## 开发信息

- **开发者**: Q3CC & Claude
- **版本**: 1.0.0
- **兼容性**: ToolDelta框架
- **依赖**: 前置-世界交互

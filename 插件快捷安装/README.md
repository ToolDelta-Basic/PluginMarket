# 插件快捷安装 - ToolDelta Demo 插件

这是一个为 ToolDelta 框架提供的 demo 插件,实现了快捷安装插件的功能,对应 GitHub Issue 中提出的功能需求。

## 功能特性

- 快捷安装插件命令,无需进入插件市场多级菜单
- 支持通过插件 ID 或名称搜索插件
- **支持安装插件整合包**
- 支持自定义插件市场源
- 支持跳过二次确认的快速安装模式
- 自动下载和安装插件及其前置插件
- 可扩展的命令架构,便于后期添加更多子命令

## 安装方法

1. 将整个 `插件快捷安装` 文件夹复制到 `插件文件/ToolDelta类式插件/` 目录下
2. 重启 ToolDelta 或使用 `reload` 命令重载插件

## 使用方法

### 查看帮助

只输入主命令而不带任何参数，会显示帮助信息：

```bash
plg
# 或
plugin
```

### 基本用法

```bash
plg add <插件ID或名称>
```

### 示例

```bash
# 通过插件名称安装
plg add 聊天栏菜单

# 通过插件 ID 安装
plg add chatbar_menu

# 安装整合包
plg add 防挂插件包

# 使用别名命令
plugin add economy
```

### 高级参数

参数可以以任意顺序组合使用，提供更灵活的使用方式。

#### 1. 指定自定义插件市场源

使用 `-url` 参数指定自定义的插件市场源:

```bash
plg add <插件名> -url <插件市场源URL>
# 参数顺序可以调换
plg add -url <插件市场源URL> <插件名>
```

如果不指定 `-url` 参数,则使用 `ToolDelta基本配置.json` 中配置的默认插件市场源。

#### 2. 跳过二次确认

使用 `-y` 参数跳过安装确认提示,直接安装:

```bash
plg add <插件名> -y
# 参数顺序可以调换
plg add -y <插件名>

# 组合使用 -url 和 -y，顺序任意
plg add economy -url https://example.com/market -y
plg add -y -url https://example.com/market economy
plg add -url https://example.com/market economy -y
```


## 安装流程

1. 根据输入的关键词搜索插件(支持 ID 精确匹配和名称模糊匹配)
2. 显示找到的插件信息(名称、作者、版本、描述、前置插件等)
3. 如果未使用 `-y` 参数,会要求用户确认是否安装
4. 自动下载插件及其所有前置插件
5. 提示安装完成,建议使用 `reload` 命令重载插件

## 搜索匹配规则

插件和整合包搜索按以下优先级进行:

1. **插件 ID 精确匹配** - 优先级最高
2. **插件名称模糊匹配** - 使用部分名称搜索
3. **插件数据名称搜索** - 在插件详细数据中搜索
4. **整合包名称搜索** - 在整合包中进行名称匹配

注意: 所有搜索均不区分大小写

## 注意事项

- 安装完成后需要使用 `reload` 命令重载插件才能使其生效
- 如果插件有前置插件,会自动一起下载安装
- 使用自定义插件市场源时,请确保源地址正确且可访问
- 插件名称搜索不区分大小写

## 实现原理

该插件通过以下方式实现:

1. 使用 `frame.add_console_cmd_trigger()` 注册控制台命令
2. 调用 ToolDelta 内置的 `plugin_market` 模块进行插件搜索和下载
3. 复用官方插件市场的所有逻辑,确保稳定性和兼容性

